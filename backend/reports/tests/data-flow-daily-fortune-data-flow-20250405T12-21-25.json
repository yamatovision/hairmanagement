{"numFailedTestSuites":1,"numFailedTests":8,"numPassedTestSuites":0,"numPassedTests":6,"numPendingTestSuites":0,"numPendingTests":0,"numRuntimeErrorTestSuites":0,"numTodoTests":0,"numTotalTestSuites":1,"numTotalTests":14,"openHandles":[],"snapshot":{"added":0,"didUpdate":false,"failure":false,"filesAdded":0,"filesRemoved":0,"filesRemovedList":[],"filesUnmatched":0,"filesUpdated":0,"matched":0,"total":0,"unchecked":0,"uncheckedKeysByFile":[],"unmatched":0,"updated":0},"startTime":1743823290459,"success":false,"testResults":[{"assertionResults":[{"ancestorTitles":["DailyFortuneService Data Flow Tests","getDailyFortune"],"duration":30,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalled()\n\nExpected number of calls: >= 1\nReceived number of calls:    0","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalled()\n\nExpected number of calls: >= 1\nReceived number of calls:    0\n    at /Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/src/tests/saju/daily-fortune-data-flow.test.ts:293:64\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/src/tests/saju/daily-fortune-data-flow.test.ts:12:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"DailyFortuneService Data Flow Tests getDailyFortune 既存の運勢情報がない場合、新しい運勢情報を生成して返す","invocations":1,"location":null,"numPassingAsserts":7,"retryReasons":[],"status":"failed","title":"既存の運勢情報がない場合、新しい運勢情報を生成して返す"},{"ancestorTitles":["DailyFortuneService Data Flow Tests","getDailyFortune"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalled()\n\nExpected number of calls: >= 1\nReceived number of calls:    0","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalled()\n\nExpected number of calls: >= 1\nReceived number of calls:    0\n    at /Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/src/tests/saju/daily-fortune-data-flow.test.ts:322:64\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/src/tests/saju/daily-fortune-data-flow.test.ts:12:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"DailyFortuneService Data Flow Tests getDailyFortune 既存の運勢情報がある場合、既存データを拡張して返す","invocations":1,"location":null,"numPassingAsserts":6,"retryReasons":[],"status":"failed","title":"既存の運勢情報がある場合、既存データを拡張して返す"},{"ancestorTitles":["DailyFortuneService Data Flow Tests","getDailyFortune"],"duration":9,"failureDetails":[],"failureMessages":[],"fullName":"DailyFortuneService Data Flow Tests getDailyFortune ユーザーが見つからない場合、エラーをスローする","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"ユーザーが見つからない場合、エラーをスローする"},{"ancestorTitles":["DailyFortuneService Data Flow Tests","getDailyFortune"],"duration":6,"failureDetails":[{"message":"expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: {\"advice\": \"アドバイスは構造化形式で提供されています\", \"aiGeneratedAdvice\": {\"advice\": \"# 今日のあなたの運気\n本日の運勢は良好です。·\n# 個人目標へのアドバイス\n業務改善に取り組む良い日です。·\n# チーム目標へのアドバイス\nチームとの連携を積極的に進めましょう。\", \"luckyPoints\": {\"action\": \"朝の散歩\", \"color\": \"青\", \"items\": [\"鈴\", \"青い文房具\"], \"number\": 7}}, \"categories\": undefined, \"createdAt\": \"2025-04-05T03:21:31.866Z\", \"date\": \"2025-04-04\", \"id\": \"test-fortune-id\", \"overallScore\": 80, \"rating\": \"excellent\", \"sajuData\": {\"compatibility\": 80, \"mainElement\": \"未設定\", \"yinYang\": \"未設定\"}, \"starRating\": 4}"}],"failureMessages":["Error: expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: {\"advice\": \"アドバイスは構造化形式で提供されています\", \"aiGeneratedAdvice\": {\"advice\": \"# 今日のあなたの運気\n本日の運勢は良好です。·\n# 個人目標へのアドバイス\n業務改善に取り組む良い日です。·\n# チーム目標へのアドバイス\nチームとの連携を積極的に進めましょう。\", \"luckyPoints\": {\"action\": \"朝の散歩\", \"color\": \"青\", \"items\": [\"鈴\", \"青い文房具\"], \"number\": 7}}, \"categories\": undefined, \"createdAt\": \"2025-04-05T03:21:31.866Z\", \"date\": \"2025-04-04\", \"id\": \"test-fortune-id\", \"overallScore\": 80, \"rating\": \"excellent\", \"sajuData\": {\"compatibility\": 80, \"mainElement\": \"未設定\", \"yinYang\": \"未設定\"}, \"starRating\": 4}\n    at expect (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/expect/build/index.js:113:15)\n    at /Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/src/tests/saju/daily-fortune-data-flow.test.ts:348:13\n    at Generator.next (<anonymous>)\n    at /Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/src/tests/saju/daily-fortune-data-flow.test.ts:15:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/src/tests/saju/daily-fortune-data-flow.test.ts:11:12)\n    at Object.<anonymous> (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/src/tests/saju/daily-fortune-data-flow.test.ts:341:55)\n    at Promise.then.completed (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"DailyFortuneService Data Flow Tests getDailyFortune ユーザーの生年月日が設定されていない場合、エラーをスローする","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"ユーザーの生年月日が設定されていない場合、エラーをスローする"},{"ancestorTitles":["DailyFortuneService Data Flow Tests","calculateCompatibilityScore"],"duration":0,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalled()\n\nExpected number of calls: >= 1\nReceived number of calls:    0","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalled()\n\nExpected number of calls: >= 1\nReceived number of calls:    0\n    at /Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/src/tests/saju/daily-fortune-data-flow.test.ts:363:56\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/src/tests/saju/daily-fortune-data-flow.test.ts:12:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"DailyFortuneService Data Flow Tests calculateCompatibilityScore SajuDataTransformerを使用して互換性スコアを計算する","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"SajuDataTransformerを使用して互換性スコアを計算する"},{"ancestorTitles":["DailyFortuneService Data Flow Tests","calculateCompatibilityScore"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"DailyFortuneService Data Flow Tests calculateCompatibilityScore SajuDataTransformer失敗時、フォールバック計算を使用する","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"SajuDataTransformer失敗時、フォールバック計算を使用する"},{"ancestorTitles":["DailyFortuneService Data Flow Tests","calculateCompatibilityScore"],"duration":13,"failureDetails":[{"matcherResult":{"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"ユーザーの四柱推命データが不完全です\"\nReceived message:   \"Cannot read properties of undefined (reading 'stem')\"\n\n      192 |     \n      193 |     // 日主（ユーザーの日干）\n    > 194 |     const dayMaster = userSaju.fourPillars.dayPillar.stem;\n          |                                                      ^\n      195 |     \n      196 |     // 当日の天干地支\n      197 |     const todayStem = dayFourPillars.dayPillar.stem;\n\n      at DailyFortuneService.calculateCompatibilityScore (src/application/services/daily-fortune.service.ts:194:54)\n      at src/tests/saju/daily-fortune-data-flow.test.ts:355:38\n      at src/tests/saju/daily-fortune-data-flow.test.ts:15:71\n      at Object.<anonymous>.__awaiter (src/tests/saju/daily-fortune-data-flow.test.ts:11:12)\n      at calculateScore (src/tests/saju/daily-fortune-data-flow.test.ts:354:73)\n      at src/tests/saju/daily-fortune-data-flow.test.ts:406:20\n      at src/tests/saju/daily-fortune-data-flow.test.ts:15:71\n      at Object.<anonymous>.__awaiter (src/tests/saju/daily-fortune-data-flow.test.ts:11:12)\n      at Object.<anonymous> (src/tests/saju/daily-fortune-data-flow.test.ts:395:46)","pass":false},"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"ユーザーの四柱推命データが不完全です\"\nReceived message:   \"Cannot read properties of undefined (reading 'stem')\"\n\n      192 |     \n      193 |     // 日主（ユーザーの日干）\n    > 194 |     const dayMaster = userSaju.fourPillars.dayPillar.stem;\n          |                                                      ^\n      195 |     \n      196 |     // 当日の天干地支\n      197 |     const todayStem = dayFourPillars.dayPillar.stem;\n\n      at DailyFortuneService.calculateCompatibilityScore (src/application/services/daily-fortune.service.ts:194:54)\n      at src/tests/saju/daily-fortune-data-flow.test.ts:355:38\n      at src/tests/saju/daily-fortune-data-flow.test.ts:15:71\n      at Object.<anonymous>.__awaiter (src/tests/saju/daily-fortune-data-flow.test.ts:11:12)\n      at calculateScore (src/tests/saju/daily-fortune-data-flow.test.ts:354:73)\n      at src/tests/saju/daily-fortune-data-flow.test.ts:406:20\n      at src/tests/saju/daily-fortune-data-flow.test.ts:15:71\n      at Object.<anonymous>.__awaiter (src/tests/saju/daily-fortune-data-flow.test.ts:11:12)\n      at Object.<anonymous> (src/tests/saju/daily-fortune-data-flow.test.ts:395:46)"}],"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"ユーザーの四柱推命データが不完全です\"\nReceived message:   \"Cannot read properties of undefined (reading 'stem')\"\n\n      192 |     \n      193 |     // 日主（ユーザーの日干）\n    > 194 |     const dayMaster = userSaju.fourPillars.dayPillar.stem;\n          |                                                      ^\n      195 |     \n      196 |     // 当日の天干地支\n      197 |     const todayStem = dayFourPillars.dayPillar.stem;\n\n      at DailyFortuneService.calculateCompatibilityScore (src/application/services/daily-fortune.service.ts:194:54)\n      at src/tests/saju/daily-fortune-data-flow.test.ts:355:38\n      at src/tests/saju/daily-fortune-data-flow.test.ts:15:71\n      at Object.<anonymous>.__awaiter (src/tests/saju/daily-fortune-data-flow.test.ts:11:12)\n      at calculateScore (src/tests/saju/daily-fortune-data-flow.test.ts:354:73)\n      at src/tests/saju/daily-fortune-data-flow.test.ts:406:20\n      at src/tests/saju/daily-fortune-data-flow.test.ts:15:71\n      at Object.<anonymous>.__awaiter (src/tests/saju/daily-fortune-data-flow.test.ts:11:12)\n      at Object.<anonymous> (src/tests/saju/daily-fortune-data-flow.test.ts:395:46)\n    at Object.toThrow (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/expect/build/index.js:218:22)\n    at /Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/src/tests/saju/daily-fortune-data-flow.test.ts:407:18\n    at Generator.next (<anonymous>)\n    at /Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/src/tests/saju/daily-fortune-data-flow.test.ts:15:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/src/tests/saju/daily-fortune-data-flow.test.ts:11:12)\n    at Object.<anonymous> (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/src/tests/saju/daily-fortune-data-flow.test.ts:395:46)\n    at Promise.then.completed (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"DailyFortuneService Data Flow Tests calculateCompatibilityScore 不完全な四柱情報の場合、エラーをスローする","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"不完全な四柱情報の場合、エラーをスローする"},{"ancestorTitles":["DailyFortuneService Data Flow Tests","calculateCompatibilityScore"],"duration":7,"failureDetails":[{"matcherResult":{"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"指定日の四柱データが不完全です\"\nReceived message:   \"Cannot read properties of undefined (reading 'stem')\"\n\n      195 |     \n      196 |     // 当日の天干地支\n    > 197 |     const todayStem = dayFourPillars.dayPillar.stem;\n          |                                                ^\n      198 |     const todayBranch = dayFourPillars.dayPillar.branch;\n      199 |     \n      200 |     // 当日の十神関係（日干から見た当日の天干の関係）\n\n      at DailyFortuneService.calculateCompatibilityScore (src/application/services/daily-fortune.service.ts:197:48)\n      at src/tests/saju/daily-fortune-data-flow.test.ts:355:38\n      at src/tests/saju/daily-fortune-data-flow.test.ts:15:71\n      at Object.<anonymous>.__awaiter (src/tests/saju/daily-fortune-data-flow.test.ts:11:12)\n      at calculateScore (src/tests/saju/daily-fortune-data-flow.test.ts:354:73)\n      at src/tests/saju/daily-fortune-data-flow.test.ts:419:20\n      at src/tests/saju/daily-fortune-data-flow.test.ts:15:71\n      at Object.<anonymous>.__awaiter (src/tests/saju/daily-fortune-data-flow.test.ts:11:12)\n      at Object.<anonymous> (src/tests/saju/daily-fortune-data-flow.test.ts:410:48)","pass":false},"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"指定日の四柱データが不完全です\"\nReceived message:   \"Cannot read properties of undefined (reading 'stem')\"\n\n      195 |     \n      196 |     // 当日の天干地支\n    > 197 |     const todayStem = dayFourPillars.dayPillar.stem;\n          |                                                ^\n      198 |     const todayBranch = dayFourPillars.dayPillar.branch;\n      199 |     \n      200 |     // 当日の十神関係（日干から見た当日の天干の関係）\n\n      at DailyFortuneService.calculateCompatibilityScore (src/application/services/daily-fortune.service.ts:197:48)\n      at src/tests/saju/daily-fortune-data-flow.test.ts:355:38\n      at src/tests/saju/daily-fortune-data-flow.test.ts:15:71\n      at Object.<anonymous>.__awaiter (src/tests/saju/daily-fortune-data-flow.test.ts:11:12)\n      at calculateScore (src/tests/saju/daily-fortune-data-flow.test.ts:354:73)\n      at src/tests/saju/daily-fortune-data-flow.test.ts:419:20\n      at src/tests/saju/daily-fortune-data-flow.test.ts:15:71\n      at Object.<anonymous>.__awaiter (src/tests/saju/daily-fortune-data-flow.test.ts:11:12)\n      at Object.<anonymous> (src/tests/saju/daily-fortune-data-flow.test.ts:410:48)"}],"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"指定日の四柱データが不完全です\"\nReceived message:   \"Cannot read properties of undefined (reading 'stem')\"\n\n      195 |     \n      196 |     // 当日の天干地支\n    > 197 |     const todayStem = dayFourPillars.dayPillar.stem;\n          |                                                ^\n      198 |     const todayBranch = dayFourPillars.dayPillar.branch;\n      199 |     \n      200 |     // 当日の十神関係（日干から見た当日の天干の関係）\n\n      at DailyFortuneService.calculateCompatibilityScore (src/application/services/daily-fortune.service.ts:197:48)\n      at src/tests/saju/daily-fortune-data-flow.test.ts:355:38\n      at src/tests/saju/daily-fortune-data-flow.test.ts:15:71\n      at Object.<anonymous>.__awaiter (src/tests/saju/daily-fortune-data-flow.test.ts:11:12)\n      at calculateScore (src/tests/saju/daily-fortune-data-flow.test.ts:354:73)\n      at src/tests/saju/daily-fortune-data-flow.test.ts:419:20\n      at src/tests/saju/daily-fortune-data-flow.test.ts:15:71\n      at Object.<anonymous>.__awaiter (src/tests/saju/daily-fortune-data-flow.test.ts:11:12)\n      at Object.<anonymous> (src/tests/saju/daily-fortune-data-flow.test.ts:410:48)\n    at Object.toThrow (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/expect/build/index.js:218:22)\n    at /Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/src/tests/saju/daily-fortune-data-flow.test.ts:420:18\n    at Generator.next (<anonymous>)\n    at /Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/src/tests/saju/daily-fortune-data-flow.test.ts:15:71\n    at new Promise (<anonymous>)\n    at Object.<anonymous>.__awaiter (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/src/tests/saju/daily-fortune-data-flow.test.ts:11:12)\n    at Object.<anonymous> (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/src/tests/saju/daily-fortune-data-flow.test.ts:410:48)\n    at Promise.then.completed (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"DailyFortuneService Data Flow Tests calculateCompatibilityScore 不完全な日次四柱情報の場合、エラーをスローする","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"不完全な日次四柱情報の場合、エラーをスローする"},{"ancestorTitles":["DailyFortuneService Data Flow Tests","enrichFortuneData"],"duration":13,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalled()\n\nExpected number of calls: >= 1\nReceived number of calls:    0","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalled()\n\nExpected number of calls: >= 1\nReceived number of calls:    0\n    at /Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/src/tests/saju/daily-fortune-data-flow.test.ts:435:64\n    at Generator.next (<anonymous>)\n    at fulfilled (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/src/tests/saju/daily-fortune-data-flow.test.ts:12:58)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)"],"fullName":"DailyFortuneService Data Flow Tests enrichFortuneData 運勢データにカレンダー情報とSajuDataを追加する","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"運勢データにカレンダー情報とSajuDataを追加する"},{"ancestorTitles":["DailyFortuneService Data Flow Tests","enrichFortuneData"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"DailyFortuneService Data Flow Tests enrichFortuneData DailyCalendarInfoService失敗時もエラーをスローせず結果を返す","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"DailyCalendarInfoService失敗時もエラーをスローせず結果を返す"},{"ancestorTitles":["DailyFortuneService Data Flow Tests","parseAIResponse"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"DailyFortuneService Data Flow Tests parseAIResponse テキストレスポンスを正しく構造化する","invocations":1,"location":null,"numPassingAsserts":10,"retryReasons":[],"status":"passed","title":"テキストレスポンスを正しく構造化する"},{"ancestorTitles":["DailyFortuneService Data Flow Tests","parseAIResponse"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"DailyFortuneService Data Flow Tests parseAIResponse JSONレスポンスを正しく処理する","invocations":1,"location":null,"numPassingAsserts":10,"retryReasons":[],"status":"passed","title":"JSONレスポンスを正しく処理する"},{"ancestorTitles":["DailyFortuneService Data Flow Tests","parseAIResponse"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"DailyFortuneService Data Flow Tests parseAIResponse オブジェクトレスポンスを正しく処理する","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"オブジェクトレスポンスを正しく処理する"},{"ancestorTitles":["DailyFortuneService Data Flow Tests","parseAIResponse"],"duration":2,"failureDetails":[{}],"failureMessages":["TypeError: Cannot read properties of null (reading 'advice')\n    at Object.<anonymous> (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/src/tests/saju/daily-fortune-data-flow.test.ts:561:21)\n    at Promise.then.completed (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at _runTest (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"DailyFortuneService Data Flow Tests parseAIResponse 無効なレスポンスでもデフォルト値を返す","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"無効なレスポンスでもデフォルト値を返す"}],"endTime":1743823291930,"message":"  ● DailyFortuneService Data Flow Tests › getDailyFortune › 既存の運勢情報がない場合、新しい運勢情報を生成して返す\n\n    expect(jest.fn()).toHaveBeenCalled()\n\n    Expected number of calls: >= 1\n    Received number of calls:    0\n\n      291 |       \n      292 |       // フェーズ2で追加されたサービスが呼ばれたことを確認\n    > 293 |       expect(dailyCalendarInfoService.getOrCreateCalendarInfo).toHaveBeenCalled();\n          |                                                                ^\n      294 |       expect(sajuDataTransformer.createFortuneCompatibilityData).toHaveBeenCalled();\n      295 |       expect(sajuDataTransformer.combineFortuneWithCalendarInfo).toHaveBeenCalled();\n      296 |       \n\n      at src/tests/saju/daily-fortune-data-flow.test.ts:293:64\n      at fulfilled (src/tests/saju/daily-fortune-data-flow.test.ts:12:58)\n\n  ● DailyFortuneService Data Flow Tests › getDailyFortune › 既存の運勢情報がある場合、既存データを拡張して返す\n\n    expect(jest.fn()).toHaveBeenCalled()\n\n    Expected number of calls: >= 1\n    Received number of calls:    0\n\n      320 |       \n      321 |       // フェーズ2で追加された拡張機能だけが呼ばれることを確認\n    > 322 |       expect(dailyCalendarInfoService.getOrCreateCalendarInfo).toHaveBeenCalled();\n          |                                                                ^\n      323 |       expect(sajuDataTransformer.combineFortuneWithCalendarInfo).toHaveBeenCalled();\n      324 |       \n      325 |       // 結果を検証\n\n      at src/tests/saju/daily-fortune-data-flow.test.ts:322:64\n      at fulfilled (src/tests/saju/daily-fortune-data-flow.test.ts:12:58)\n\n  ● DailyFortuneService Data Flow Tests › getDailyFortune › ユーザーの生年月日が設定されていない場合、エラーをスローする\n\n    expect(received).rejects.toThrow()\n\n    Received promise resolved instead of rejected\n    Resolved to value: {\"advice\": \"アドバイスは構造化形式で提供されています\", \"aiGeneratedAdvice\": {\"advice\": \"# 今日のあなたの運気\n    本日の運勢は良好です。·\n    # 個人目標へのアドバイス\n    業務改善に取り組む良い日です。·\n    # チーム目標へのアドバイス\n    チームとの連携を積極的に進めましょう。\", \"luckyPoints\": {\"action\": \"朝の散歩\", \"color\": \"青\", \"items\": [\"鈴\", \"青い文房具\"], \"number\": 7}}, \"categories\": undefined, \"createdAt\": \"2025-04-05T03:21:31.866Z\", \"date\": \"2025-04-04\", \"id\": \"test-fortune-id\", \"overallScore\": 80, \"rating\": \"excellent\", \"sajuData\": {\"compatibility\": 80, \"mainElement\": \"未設定\", \"yinYang\": \"未設定\"}, \"starRating\": 4}\n\n      346 |       \n      347 |       // 関数の実行でエラーが発生することを確認\n    > 348 |       await expect(fortuneService.getDailyFortune(userId)).rejects.toThrow('ユーザーの生年月日が設定されていません');\n          |             ^\n      349 |     });\n      350 |   });\n      351 |\n\n      at expect (node_modules/expect/build/index.js:113:15)\n      at src/tests/saju/daily-fortune-data-flow.test.ts:348:13\n      at src/tests/saju/daily-fortune-data-flow.test.ts:15:71\n      at Object.<anonymous>.__awaiter (src/tests/saju/daily-fortune-data-flow.test.ts:11:12)\n      at Object.<anonymous> (src/tests/saju/daily-fortune-data-flow.test.ts:341:55)\n\n  ● DailyFortuneService Data Flow Tests › calculateCompatibilityScore › SajuDataTransformerを使用して互換性スコアを計算する\n\n    expect(jest.fn()).toHaveBeenCalled()\n\n    Expected number of calls: >= 1\n    Received number of calls:    0\n\n      361 |       \n      362 |       // SajuDataTransformerが呼ばれたことを確認\n    > 363 |       expect(sajuDataTransformer.extractElementalInfo).toHaveBeenCalled();\n          |                                                        ^\n      364 |       expect(sajuDataTransformer.createFortuneCompatibilityData).toHaveBeenCalled();\n      365 |       \n      366 |       // 結果を検証\n\n      at src/tests/saju/daily-fortune-data-flow.test.ts:363:56\n      at fulfilled (src/tests/saju/daily-fortune-data-flow.test.ts:12:58)\n\n  ● DailyFortuneService Data Flow Tests › calculateCompatibilityScore › 不完全な四柱情報の場合、エラーをスローする\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"ユーザーの四柱推命データが不完全です\"\n    Received message:   \"Cannot read properties of undefined (reading 'stem')\"\n\n          192 |     \n          193 |     // 日主（ユーザーの日干）\n        > 194 |     const dayMaster = userSaju.fourPillars.dayPillar.stem;\n              |                                                      ^\n          195 |     \n          196 |     // 当日の天干地支\n          197 |     const todayStem = dayFourPillars.dayPillar.stem;\n\n      at DailyFortuneService.calculateCompatibilityScore (src/application/services/daily-fortune.service.ts:194:54)\n      at src/tests/saju/daily-fortune-data-flow.test.ts:355:38\n      at src/tests/saju/daily-fortune-data-flow.test.ts:15:71\n      at Object.<anonymous>.__awaiter (src/tests/saju/daily-fortune-data-flow.test.ts:11:12)\n      at calculateScore (src/tests/saju/daily-fortune-data-flow.test.ts:354:73)\n      at src/tests/saju/daily-fortune-data-flow.test.ts:406:20\n      at src/tests/saju/daily-fortune-data-flow.test.ts:15:71\n      at Object.<anonymous>.__awaiter (src/tests/saju/daily-fortune-data-flow.test.ts:11:12)\n      at Object.<anonymous> (src/tests/saju/daily-fortune-data-flow.test.ts:395:46)\n      at Object.toThrow (node_modules/expect/build/index.js:218:22)\n      at src/tests/saju/daily-fortune-data-flow.test.ts:407:18\n      at src/tests/saju/daily-fortune-data-flow.test.ts:15:71\n      at Object.<anonymous>.__awaiter (src/tests/saju/daily-fortune-data-flow.test.ts:11:12)\n      at Object.<anonymous> (src/tests/saju/daily-fortune-data-flow.test.ts:395:46)\n\n  ● DailyFortuneService Data Flow Tests › calculateCompatibilityScore › 不完全な日次四柱情報の場合、エラーをスローする\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"指定日の四柱データが不完全です\"\n    Received message:   \"Cannot read properties of undefined (reading 'stem')\"\n\n          195 |     \n          196 |     // 当日の天干地支\n        > 197 |     const todayStem = dayFourPillars.dayPillar.stem;\n              |                                                ^\n          198 |     const todayBranch = dayFourPillars.dayPillar.branch;\n          199 |     \n          200 |     // 当日の十神関係（日干から見た当日の天干の関係）\n\n      at DailyFortuneService.calculateCompatibilityScore (src/application/services/daily-fortune.service.ts:197:48)\n      at src/tests/saju/daily-fortune-data-flow.test.ts:355:38\n      at src/tests/saju/daily-fortune-data-flow.test.ts:15:71\n      at Object.<anonymous>.__awaiter (src/tests/saju/daily-fortune-data-flow.test.ts:11:12)\n      at calculateScore (src/tests/saju/daily-fortune-data-flow.test.ts:354:73)\n      at src/tests/saju/daily-fortune-data-flow.test.ts:419:20\n      at src/tests/saju/daily-fortune-data-flow.test.ts:15:71\n      at Object.<anonymous>.__awaiter (src/tests/saju/daily-fortune-data-flow.test.ts:11:12)\n      at Object.<anonymous> (src/tests/saju/daily-fortune-data-flow.test.ts:410:48)\n      at Object.toThrow (node_modules/expect/build/index.js:218:22)\n      at src/tests/saju/daily-fortune-data-flow.test.ts:420:18\n      at src/tests/saju/daily-fortune-data-flow.test.ts:15:71\n      at Object.<anonymous>.__awaiter (src/tests/saju/daily-fortune-data-flow.test.ts:11:12)\n      at Object.<anonymous> (src/tests/saju/daily-fortune-data-flow.test.ts:410:48)\n\n  ● DailyFortuneService Data Flow Tests › enrichFortuneData › 運勢データにカレンダー情報とSajuDataを追加する\n\n    expect(jest.fn()).toHaveBeenCalled()\n\n    Expected number of calls: >= 1\n    Received number of calls:    0\n\n      433 |       \n      434 |       // サービスが呼ばれたことを確認\n    > 435 |       expect(dailyCalendarInfoService.getOrCreateCalendarInfo).toHaveBeenCalled();\n          |                                                                ^\n      436 |       expect(sajuDataTransformer.combineFortuneWithCalendarInfo).toHaveBeenCalled();\n      437 |       \n      438 |       // 結果を検証\n\n      at src/tests/saju/daily-fortune-data-flow.test.ts:435:64\n      at fulfilled (src/tests/saju/daily-fortune-data-flow.test.ts:12:58)\n\n  ● DailyFortuneService Data Flow Tests › parseAIResponse › 無効なレスポンスでもデフォルト値を返す\n\n    TypeError: Cannot read properties of null (reading 'advice')\n\n      559 |       // 結果を検証\n      560 |       expect(result).toBeDefined();\n    > 561 |       expect(result.advice).toContain('本日の運勢データを準備中です');\n          |                     ^\n      562 |       expect(result.luckyPoints).toBeDefined();\n      563 |       expect(result.luckyPoints.color).toBe('赤');\n      564 |       expect(result.luckyPoints.items.length).toBeGreaterThan(0);\n\n      at Object.<anonymous> (src/tests/saju/daily-fortune-data-flow.test.ts:561:21)\n","name":"/Users/tatsuya/Desktop/システム開発/AppGenius2/patrolmanagement/backend/src/tests/saju/daily-fortune-data-flow.test.ts","startTime":1743823290593,"status":"failed","summary":""}],"wasInterrupted":false}
