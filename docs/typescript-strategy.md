# TypeScript型安全性の戦略

## 現状と方針

当プロジェクトでは、TypeScriptの型安全性について以下のアプローチを採用しています：

### 現在の設定 (2025/04/05)

```json
{
  "strict": true,              // 厳格モードを有効化
  "noImplicitAny": false,      // 暗黙のany型を許容（占いロジックの複雑性を考慮）
  "strictNullChecks": true,    // null/undefinedのチェックを厳格化
  "strictFunctionTypes": true, // 関数型チェックを厳格化
  "noImplicitThis": true,      // thisの型チェックを厳格化
  "noImplicitReturns": false,  // 関数の全パスがreturnを持つことの検証を一時的に無効化
}
```

### 採用理由

1. **プロジェクトの特性**
   - 四柱推命や占いロジックは複雑な参照表や伝統的なアルゴリズムを使用
   - 異なる文化的・歴史的コンテキストに由来する計算式が多数存在
   - 複数の変換ロジックやデータ構造が相互に関連

2. **実用性と開発効率のバランス**
   - 厳格なnoImplicitAny=trueに設定すると400件以上のエラーが発生
   - プロジェクト進捗率96%の現時点で、全エラー修正は非効率的
   - null/undefinedに関する厳格なチェックは維持して重大なバグを防止

### 今後の計画

1. **段階的な型安全性向上**
   - プロジェクト安定後、計画的にany型を削減
   - コア部分（API層、リポジトリ層など）から優先的に型付け強化
   - 占いロジック部分は実用的なアプローチで対応

2. **ガイドライン**
   - 新規コードは可能な限り明示的な型定義を行う
   - パブリックAPIとインターフェースは常に型定義を明記
   - 占いロジックでany型を使用する場合はコメントで理由を記載

3. **最終目標**
   - 長期的には全体の型安全性を高め、メンテナンス性を向上
   - 自動化ツールも活用して段階的に型定義を追加

## 優先的に型付けを強化すべき箇所

1. APIエンドポイント（コントローラー層）
2. リポジトリインターフェース
3. データモデルとエンティティ
4. サービス層のパブリックメソッド

## 特別な考慮事項

占いロジックのような特殊な計算アルゴリズムについては、一部でany型の使用を許容しつつも、コア部分では型安全性を確保するバランスを取ります。